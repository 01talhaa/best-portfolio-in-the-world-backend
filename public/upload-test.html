<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Test with Entity Association</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .response-area {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .file-input {
            margin: 15px 0;
        }
    </style>
    <script src="js/api-config.js"></script>
</head>
<body>
    <div class="container">
        <h1>üöÄ Upload Test with Entity Association</h1>
        
        <!-- Authentication Section -->
        <div class="test-section">
            <h3>Authentication</h3>
            <div class="form-group">
                <label for="token">JWT Token:</label>
                <input type="text" id="token" placeholder="Enter your JWT token here">
            </div>
            <button class="btn" id="testAuthBtn">Test Authentication</button>
            <div id="authResponse" class="response-area"></div>
        </div>
        
        <!-- Upload Test Section -->
        <div class="test-section">
            <h3>Entity-Specific Upload Test</h3>
            
            <div class="file-input">
                <label for="testFile">Select File:</label>
                <input type="file" id="testFile">
            </div>
            
            <div class="form-group">
                <label for="entityType">Entity Type:</label>
                <select id="entityType">
                    <option value="">None (standalone upload)</option>
                    <option value="project">Project</option>
                    <option value="team-member">Team Member</option>
                    <option value="blog">Blog</option>
                    <option value="service">Service</option>
                    <option value="client">Client</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="entityId">Entity ID:</label>
                <input type="text" id="entityId" placeholder="Enter entity ID (e.g., 507f1f77bcf86cd799439011)">
            </div>
            
            <div class="form-group">
                <label for="imageType">Image Type:</label>
                <select id="imageType">
                    <option value="gallery">Gallery Image (default)</option>
                    <option value="thumbnail">Thumbnail (projects only)</option>
                    <option value="icon">Icon (services only)</option>
                    <option value="profile">Profile Image (team members only)</option>
                    <option value="logo">Logo (clients only)</option>
                </select>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Choose the type of image for proper field assignment
                </small>
            </div>
            
            <div class="form-group">
                <label for="description">Description (optional):</label>
                <input type="text" id="description" placeholder="Brief description of this upload">
            </div>
            
            <button class="btn" id="uploadFileBtn">Upload File</button>
            <button class="btn" id="clearFormBtn">Clear Form</button>
            
            <div id="uploadResponse" class="response-area"></div>
        </div>
        
        <!-- Sample Entity IDs for Testing -->
        <div class="test-section">
            <h3>üìã Sample Entity IDs for Testing</h3>
            <p>Use these sample IDs to test entity associations:</p>
            <ul>
                <li><strong>Project:</strong> 507f1f77bcf86cd799439011</li>
                <li><strong>Team Member:</strong> 507f1f77bcf86cd799439012</li>
                <li><strong>Blog:</strong> 507f1f77bcf86cd799439013</li>
                <li><strong>Service:</strong> 507f1f77bcf86cd799439014</li>
                <li><strong>Client:</strong> 507f1f77bcf86cd799439015</li>
            </ul>
        </div>
    </div>

    <script>
            
        // Remove hardcoded BASE_URL - use API_CONFIG instead
        // const BASE_URL = 'https://best-portfolio-in-the-world-backend.onrender.com/api/v1';
        let uploadedFiles = [];
        
        function getToken() {
            return document.getElementById('token').value.trim();
        }
        
        function getAuthHeaders() {
            const token = getToken();
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }
            
            return headers;
        }
        
        async function testAuth() {
            const token = getToken();
            
            if (!token) {
                showResponse('authResponse', {
                    error: 'Please enter a JWT token first'
                });
                return;
            }
            
            try {
                // Test authentication by making a simple GET request to a protected endpoint
                // Since there's no /auth/me endpoint, we'll test with projects endpoint
                const response = await API_CONFIG.makeRequest('/projects', {
                    method: 'GET'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResponse('authResponse', {
                        status: response.status,
                        statusText: response.statusText,
                        message: '‚úÖ Authentication successful! Token is valid.',
                        data: {
                            success: true,
                            message: 'Token verified successfully',
                            projectsCount: result.data ? result.data.length : 0
                        }
                    });
                } else {
                    showResponse('authResponse', {
                        status: response.status,
                        statusText: response.statusText,
                        message: '‚ùå Authentication failed! Token is invalid or expired.',
                        data: result
                    });
                }
                
            } catch (error) {
                showResponse('authResponse', {
                    error: error.message,
                    message: '‚ùå Authentication test failed!'
                });
            }
        }
        
        async function uploadFile() {
            const fileInput = document.getElementById('testFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showResponse('uploadResponse', {
                    error: 'Please select a file first'
                });
                return;
            }
            
            const token = getToken();
            if (!token) {
                showResponse('uploadResponse', {
                    error: 'Please enter a JWT token first'
                });
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            // Add entity association data if provided
            const entityType = document.getElementById('entityType').value;
            const entityId = document.getElementById('entityId').value.trim();
            const description = document.getElementById('description').value.trim();
            const imageType = document.getElementById('imageType').value;
            
            if (entityType) {
                formData.append('entityType', entityType);
            }
            
            if (entityId) {
                formData.append('entityId', entityId);
            }
            
            if (description) {
                formData.append('description', description);
            }
            
            if (imageType) {
                formData.append('imageType', imageType);
            }
            
            try {
                const response = await API_CONFIG.makeRequest('/upload/single', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                showResponse('uploadResponse', {
                    status: response.status,
                    statusText: response.statusText,
                    data: result
                });
                
            } catch (error) {
                showResponse('uploadResponse', {
                    error: error.message
                });
            }
        }
        
        function clearForm() {
            document.getElementById('testFile').value = '';
            document.getElementById('entityType').value = '';
            document.getElementById('entityId').value = '';
            document.getElementById('imageType').value = 'gallery';
            document.getElementById('description').value = '';
            document.getElementById('uploadResponse').style.display = 'none';
        }
        
        function showResponse(elementId, data) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = JSON.stringify(data, null, 2);
        }
        
        // Auto-fill sample project ID for convenience
        document.getElementById('entityType').addEventListener('change', function() {
            const entityType = this.value;
            const entityIdInput = document.getElementById('entityId');
            
            if (entityType === 'project') {
                entityIdInput.value = '507f1f77bcf86cd799439011';
            } else if (entityType === 'team-member') {
                entityIdInput.value = '507f1f77bcf86cd799439012';
            } else if (entityType === 'blog') {
                entityIdInput.value = '507f1f77bcf86cd799439013';
            } else if (entityType === 'service') {
                entityIdInput.value = '507f1f77bcf86cd799439014';
            } else if (entityType === 'client') {
                entityIdInput.value = '507f1f77bcf86cd799439015';
            } else {
                entityIdInput.value = '';
            }
        });

        // Setup button event listeners when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Upload test page loaded - setting up button event listeners');
            
            // Test auth button
            const testAuthBtn = document.getElementById('testAuthBtn');
            if (testAuthBtn) {
                testAuthBtn.addEventListener('click', function() {
                    console.log('Test auth button clicked');
                    testAuth();
                });
            }
            
            // Upload file button
            const uploadFileBtn = document.getElementById('uploadFileBtn');
            if (uploadFileBtn) {
                uploadFileBtn.addEventListener('click', function() {
                    console.log('Upload file button clicked');
                    uploadFile();
                });
            }
            
            // Clear form button
            const clearFormBtn = document.getElementById('clearFormBtn');
            if (clearFormBtn) {
                clearFormBtn.addEventListener('click', function() {
                    console.log('Clear form button clicked');
                    clearForm();
                });
            }
            
            console.log('All button event listeners set up successfully');
        });
    </script>
</body>
</html>